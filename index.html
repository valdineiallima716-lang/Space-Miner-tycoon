<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Miner - Perfil Atualizado</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- TEMA: SPACE CYBERPUNK --- */
        :root {
            --bg-dark: #050b14;
            --card-bg: #121a29;
            --primary: #0066ff;
            --secondary: #00d9ff;
            --text-gray: #8da4c4;
            --white: #ffffff;
            --success: #00c853;
            --danger: #ff4444;
            --glass: rgba(18, 26, 41, 0.9);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-dark);
            color: var(--white);
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 0;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; background: var(--bg-dark);
            position: sticky; top: 0; z-index: 100;
        }
        .brand { font-size: 20px; font-weight: 700; color: var(--white); letter-spacing: 1px; }
        .brand span { color: var(--primary); }
        .support-btn { font-size: 24px; color: var(--success); cursor: pointer; }

        /* --- HERO / CTA --- */
        .cta-container { padding: 0 20px; margin-bottom: 20px; }
        .cta-button {
            background: linear-gradient(90deg, #0066ff, #0033cc);
            color: white; width: 100%; padding: 15px;
            border-radius: 50px; border: none; font-weight: 600; font-size: 14px;
            box-shadow: 0 4px 15px rgba(0, 102, 255, 0.4);
            cursor: pointer; text-transform: uppercase;
        }

        /* --- CARDS DE STATUS (SALDO) --- */
        .stats-scroll {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
            padding: 0 20px; margin-bottom: 25px;
        }
        .stat-card {
            background: linear-gradient(180deg, #162032 0%, #0f1623 100%);
            padding: 15px 10px; border-radius: 15px;
            text-align: center; border: 1px solid #2a3b55;
            min-height: 100px; display: flex; flex-direction: column; justify-content: center;
        }
        .stat-icon { font-size: 20px; margin-bottom: 5px; display: block; }
        .stat-value { font-size: 14px; font-weight: 700; color: var(--white); display: block; }
        .stat-label { font-size: 10px; color: var(--text-gray); margin-top: 2px; }
        
        .sc-blue .stat-icon { color: var(--secondary); }
        .sc-green .stat-icon { color: var(--success); }
        .sc-purple .stat-icon { color: #d000ff; }

        /* --- A√á√ïES R√ÅPIDAS (BANNERS) --- */
        .section-title { padding: 0 20px; font-size: 18px; font-weight: 600; margin-bottom: 15px; color: var(--white); }
        
        .banner-card {
            margin: 0 20px 15px 20px;
            height: 140px; border-radius: 15px;
            background-size: cover; background-position: center;
            position: relative; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            cursor: pointer; border: 1px solid #334155;
        }
        .banner-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.1));
        }
        .banner-content { position: absolute; bottom: 15px; left: 15px; z-index: 2; }
        .banner-title { font-size: 16px; font-weight: 700; color: white; margin: 0; }
        .banner-desc { font-size: 11px; color: #ccc; margin: 0; }

        /* --- MENU INFERIOR (FIXO) --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #0a0f1c; border-top: 1px solid #1e293b;
            display: flex; justify-content: space-around; padding: 12px 0;
            z-index: 1000;
        }
        .nav-item { text-align: center; color: #64748b; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-label { font-size: 10px; font-weight: 500; }

        /* --- TELAS GERAIS --- */
        .screen { display: none; animation: fade 0.3s; padding-bottom: 20px; }
        .screen.active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .container { padding: 20px; }

        /* INPUTS & FORMS */
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 12px; color: var(--text-gray); margin-bottom: 5px; }
        input {
            width: 100%; background: #1e293b; border: 1px solid #334155;
            padding: 14px; border-radius: 10px; color: white; font-size: 14px;
        }
        input:focus { border-color: var(--primary); }

        /* PERFIL ESPEC√çFICO */
        .avatar-container {
            position: relative; width: 100px; height: 100px; margin: 0 auto 15px;
        }
        .avatar-circle {
            width: 100%; height: 100%; background: #222; border-radius: 50%;
            border: 3px solid var(--primary); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 40px; overflow: hidden; background-size: cover; background-position: center;
            cursor: pointer; position: relative;
        }
        .avatar-edit-icon {
            position: absolute; bottom: 0; right: 0; background: var(--primary);
            width: 30px; height: 30px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 14px;
            border: 2px solid var(--bg-dark); pointer-events: none;
        }
        
        .neon-box {
            background: #121a29; border: 1px solid #2a3b55;
            padding: 20px; border-radius: 15px; margin-bottom: 15px;
        }

        /* MODAIS E TOASTS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: #1e293b; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; border: 1px solid #334155; }
        
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; width: 90%; max-width: 400px; }
        .toast { background: #1e293b; color: white; padding: 12px 20px; border-radius: 50px; margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex; align-items: center; font-size: 13px; border: 1px solid #334155; }
        .toast.success { border-color: var(--success); color: var(--success); }
        .toast.error { border-color: var(--danger); color: var(--danger); }

        /* UTILS */
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: 600; margin-top: 10px; }
        .btn-telegram { background: #0088cc; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: 600; margin-top: 10px; }
        .btn-outline { background: transparent; border: 1px solid #334155; color: #8da4c4; padding: 10px; width: 100%; border-radius: 10px; margin-top: 10px; }
        
        .plan-item { background: #162032; border-radius: 12px; padding: 15px; display: flex; align-items: center; margin-bottom: 10px; border: 1px solid #2a3b55; }
        .plan-icon { width: 50px; height: 50px; background: #0f1623; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 15px; }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="screen-login" class="screen active">
        <div style="height: 100vh; display: flex; flex-direction: column; justify-content: center; padding: 30px;">
            <h1 class="brand" style="text-align: center; font-size: 32px; margin-bottom: 40px;">SPACE <span>MINER</span></h1>
            
            <div class="input-group">
                <label>Telefone</label>
                <input type="tel" id="login-phone" placeholder="(XX) 90000-0000">
            </div>
            <div class="input-group">
                <label>Senha</label>
                <input type="password" id="login-pass" placeholder="******">
            </div>
            
            <button class="btn-primary" id="btn-login" onclick="app.doLogin()">ENTRAR</button>
            <button class="btn-outline" onclick="app.nav('register')">CRIAR CONTA</button>
        </div>
    </div>

    <div id="screen-register" class="screen">
        <div style="padding: 30px; padding-top: 50px;">
            <h2 style="text-align: center; margin-bottom: 30px;">Criar Conta</h2>
            <div class="input-group"><label>Nome</label><input type="text" id="reg-name"></div>
            <div class="input-group"><label>Telefone</label><input type="tel" id="reg-phone"></div>
            <div class="input-group"><label>Senha</label><input type="password" id="reg-pass"></div>
            <div class="input-group"><label>Confirmar Senha</label><input type="password" id="reg-conf"></div>
            <div class="input-group"><label>Quem indicou? (Opcional)</label><input type="text" id="reg-ref"></div>
            <button class="btn-primary" id="btn-register" onclick="app.doRegister()">CADASTRAR</button>
            <button class="btn-outline" onclick="app.nav('login')">VOLTAR</button>
        </div>
    </div>

    <div id="screen-home" class="screen">
        <div class="app-header">
            <div class="brand">SPACE <span>MINER</span></div>
            <div class="support-btn" onclick="window.open('https://t.me/+WLkIKf8rNTU3ZWJh')">üí¨</div>
        </div>
        <div class="cta-container">
            <button class="cta-button" onclick="app.nav('hangar')">Conhe√ßa Nossos Pacotes</button>
        </div>
        <div class="stats-scroll">
            <div class="stat-card sc-blue"><span class="stat-icon">üíé</span><span class="stat-value" id="hud-gems">0</span><span class="stat-label">Cristais</span></div>
            <div class="stat-card sc-purple"><span class="stat-icon">üì¶</span><span class="stat-value" id="hud-ore">0</span><span class="stat-label">Dark Matter</span></div>
            <div class="stat-card sc-green"><span class="stat-icon">‚è±</span><span class="stat-value" id="hud-prod">0/dia</span><span class="stat-label">Lucro</span></div>
        </div>
        <div class="section-title">A√ß√µes R√°pidas</div>
        <div class="banner-card" style="background-image: url('https://images.unsplash.com/photo-1614726365723-49cfae96a690?auto=format&fit=crop&w=500&q=60');" onclick="app.nav('wallet')"><div class="banner-content"><p class="banner-title">Carteira</p><p class="banner-desc">Saques e Dep√≥sitos</p></div></div>
        <div class="banner-card" style="background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=500&q=60');" onclick="app.nav('fleet')"><div class="banner-content"><p class="banner-title">Meus Investimentos</p><p class="banner-desc">Coletar Rendimentos</p></div></div>
        <div class="banner-card" style="background-image: url('https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&w=500&q=60');" onclick="app.nav('network')"><div class="banner-content"><p class="banner-title">Indique e Ganhe</p><p class="banner-desc">Sistema de Afiliados</p></div></div>
        <div style="height: 20px;"></div>
    </div>

    <div id="screen-hangar" class="screen container">
        <h2 style="margin-top: 0;">Naves Dispon√≠veis</h2>
        <div id="list-hangar"></div>
    </div>

    <div id="screen-fleet" class="screen container">
        <h2 style="margin-top: 0;">Minha Frota</h2>
        <div id="list-fleet"></div>
    </div>

    <div id="screen-wallet" class="screen container">
        <h2 style="margin-top: 0;">Carteira</h2>
        <div class="neon-box" style="text-align:center; margin-bottom:20px;">
            <p style="font-size:12px; color:#8da4c4;">Saldo Dispon√≠vel</p>
            <h1 style="color:var(--primary); margin:5px 0;">üì¶ <span id="wallet-balance">0</span></h1>
            <p style="font-size:11px;">1000 = R$ 1,00</p>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="btn-primary" onclick="document.getElementById('sec-deposit').style.display='block'; document.getElementById('sec-withdraw').style.display='none'">DEPOSITAR</button>
            <button class="btn-outline" onclick="document.getElementById('sec-deposit').style.display='none'; document.getElementById('sec-withdraw').style.display='block'">SACAR</button>
        </div>
        <div id="sec-deposit">
            <h3>Comprar Cristais</h3>
            <div class="input-group"><label>C√≥digo</label><input type="text" id="redeem-input"><button class="btn-primary" style="margin-top:5px;" onclick="app.redeemCode()">RESGATAR</button></div>
            <h4>Pacotes Pix:</h4>
            <div id="list-shop"></div>
        </div>
        <div id="sec-withdraw" style="display:none;">
            <h3>Solicitar Saque</h3>
            <div class="input-group"><label>Chave Pix</label><input type="text" id="withdraw-key"></div>
            <div class="input-group"><label>Valor (Min 10.000)</label><input type="number" id="withdraw-amount"></div>
            <button class="btn-primary" id="btn-withdraw" onclick="app.sellResources()">SOLICITAR</button>
        </div>
    </div>

    <div id="screen-network" class="screen container">
        <h2>Afiliados</h2>
        <div class="neon-box" style="text-align:center;">
            <p>SEU C√ìDIGO</p><h1 style="color:var(--primary);" id="my-referral-code">...</h1>
            <button class="btn-outline" onclick="app.copyOnlyLink()">COPIAR LINK</button>
        </div>
        <h3>Resgatar Comiss√£o</h3>
        <div class="input-group"><input type="text" id="comm-input" placeholder="C√≥digo da Comiss√£o"><button class="btn-primary" style="margin-top:5px;" onclick="app.redeemCommission()">RESGATAR</button></div>
    </div>

    <div id="screen-profile" class="screen container" style="text-align: center;">
        <div class="avatar-container">
            <div class="avatar-circle" id="profile-avatar" onclick="document.getElementById('file-input').click()">
                <span>üì∑</span>
            </div>
            <div class="avatar-edit-icon">‚úèÔ∏è</div>
        </div>
        <input type="file" id="file-input" accept="image/*" style="display:none" onchange="app.changeAvatar(this)">
        
        <h2 id="profile-name" style="margin-bottom: 5px;">...</h2>
        <p style="color:#8da4c4; margin-top:0;">ID: <span id="profile-id">...</span></p>
        
        <div class="neon-box" style="text-align: left; margin-top: 30px;">
            <button class="btn-telegram" onclick="window.open('https://t.me/+WLkIKf8rNTU3ZWJh', '_blank')">
                üí¨ ENTRAR NO TELEGRAM
            </button>
            
            <button class="btn-outline" onclick="app.promptPasswordChange()">
                üîë MUDAR SENHA
            </button>
            
            <button class="btn-outline" onclick="app.logout()" style="border-color:var(--danger); color:var(--danger);">
                üö™ SAIR DA CONTA
            </button>
        </div>
        
        <p style="margin-top:30px; font-size:10px; opacity:0.5;" onclick="app.secretAdmin()">Admin v8.1</p>
    </div>

    <div class="bottom-nav" id="bottom-nav" style="display:none;">
        <div class="nav-item active" onclick="app.nav('home', this)"><span class="nav-icon">üè†</span><span class="nav-label">Home</span></div>
        <div class="nav-item" onclick="app.nav('network', this)"><span class="nav-icon">üë•</span><span class="nav-label">Afiliados</span></div>
        <div class="nav-item" onclick="app.nav('wallet', this)"><span class="nav-icon">üí≥</span><span class="nav-label">Carteira</span></div>
        <div class="nav-item" onclick="app.nav('fleet', this)"><span class="nav-icon">üöÄ</span><span class="nav-label">Naves</span></div>
        <div class="nav-item" onclick="app.nav('profile', this)"><span class="nav-icon">üë§</span><span class="nav-label">Perfil</span></div>
    </div>

    <div id="modal-pix" class="modal-overlay">
        <div class="modal-content">
            <h3>Pagamento Pix</h3>
            <textarea id="pix-display-area" readonly style="height:80px; font-size:11px;"></textarea>
            <button class="btn-primary" onclick="app.copyPix()">COPIAR C√ìDIGO</button>
            <button class="btn-outline" onclick="document.getElementById('modal-pix').style.display='none'">FECHAR</button>
        </div>
    </div>

    <script>
        const CLOUD_CONFIG = {
            BIN_ID: "691fb198ae596e708f6640fe",
            MASTER_KEY: "$2a$10$2mH99fVyX6u9ros4a1UV7eNDXameZOfDk92Qt1u06p2mNQej7vGP2"
        };

        const app = {
            currentUser: null, fullData: null,
            data: { name: "", phone: "", pass:"", photo: null, gems: 0, ore: 0, net_earn: 0, invite_count: 0, invite_code: "", ships: [], usedCodes: [] },
            config: {
                withdraw_fee: 0.15,
                codes: { "CRISTAL20": 20000, "VIP20": 20000, "INICIO": 5000 },
                commCodes: { "COMISSAO3": 3000, "COMISSAO7": 7500 },
                shopPacks: [
                    { price: 20, gems: 20000, pix: "00020126580014br.gov.bcb.pix0136e0307f71-e74f-4244-bdfc-a2b1dd3cf613520400005303986540520.005802BR5920Dilson Ferreira Lima" },
                    { price: 50, gems: 50000, pix: "00020126580014br.gov.bcb.pix0136940a7c2b-ebf7-4c59-941c-5bb27cd655bf520400005303986540550.005802BR5920Dilson Ferreira Lima" },
                    { price: 100, gems: 110000, pix: "00020126580014br.gov.bcb.pix0136e0307f71-e74f-4244-bdfc-a2b1dd3cf6135204000053039865406100.005802BR5920Dilson Ferreira Lima" },
                    { price: 500, gems: 550000, pix: "00020126580014br.gov.bcb.pix0136e0307f71-e74f-4244-bdfc-a2b1dd3cf6135204000053039865406500.005802BR5920Dilson Ferreira Lima" }
                ],
                ships: [
                    { name: "Sonda Alpha", cost: 20000, yield: 1800 }, 
                    { name: "Miner MK-II", cost: 50000, yield: 4500 },
                    { name: "Estrela da Morte", cost: 100000, yield: 9000 },
                    { name: "Tit√£ Gal√°ctico", cost: 500000, yield: 45000 }
                ]
            },

            init: function() {
                this.checkUrlForInvite();
                this.renderShop();
                this.renderHangar();
                setInterval(() => { if(document.getElementById('screen-fleet').classList.contains('active')) this.renderFleet(); }, 1000);
            },

            // --- CLOUD ---
            fetchCloud: async function() {
                try {
                    const res = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_CONFIG.BIN_ID}/latest`, { headers: { 'X-Master-Key': CLOUD_CONFIG.MASTER_KEY } });
                    if(!res.ok) throw new Error("Cloud");
                    const json = await res.json(); this.fullData = json.record; return this.fullData;
                } catch(e) { this.notify("Offline", "error"); return { users: JSON.parse(localStorage.getItem('space_users_db')) || {}, withdrawals: [] }; }
            },
            saveCloud: async function(d) {
                try { await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_CONFIG.BIN_ID}`, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': CLOUD_CONFIG.MASTER_KEY }, body: JSON.stringify(d) }); } catch(e) { console.log(e); }
            },
            sync: async function() {
                if(!this.currentUser) return;
                localStorage.setItem('space_data_'+this.currentUser, JSON.stringify(this.data));
                const cloud = await this.fetchCloud();
                if(cloud.users) { cloud.users[this.currentUser] = this.data; await this.saveCloud(cloud); }
            },

            // --- AUTH ---
            generateInviteCode: function() {
                const c = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; let r = "CMD-";
                for (let i=0; i<4; i++) r += c.charAt(Math.floor(Math.random() * c.length)); return r;
            },
            checkUrlForInvite: function() {
                const p = new URLSearchParams(window.location.search).get('ref');
                if(p && document.getElementById('reg-ref')) { document.getElementById('reg-ref').value = p; this.nav('register'); }
            },
            doRegister: async function() {
                const btn = document.getElementById('btn-register');
                const name = document.getElementById('reg-name').value.trim(), phone = document.getElementById('reg-phone').value.trim();
                const pass = document.getElementById('reg-pass').value;
                if(name.length<3 || phone.length<8) return this.notify("Dados inv√°lidos", "error");
                
                btn.innerText = "..."; btn.disabled = true;
                const cloud = await this.fetchCloud();
                if(!cloud.users) cloud.users = {};
                if(cloud.users[phone]) { this.notify("Telefone em uso", "error"); btn.innerText="CADASTRAR"; btn.disabled=false; return; }
                
                const newUser = { name:name, phone:phone, pass:pass, photo:null, gems:0, ore:0, net_earn:0, invite_count:0, invite_code:this.generateInviteCode(), ships:[], usedCodes:[] };
                cloud.users[phone]=newUser; await this.saveCloud(cloud);
                localStorage.setItem('space_data_'+phone, JSON.stringify(newUser));
                this.notify("Sucesso!", "success"); btn.innerText="CADASTRAR"; btn.disabled=false; this.nav('login');
            },
            doLogin: async function() {
                const btn=document.getElementById('btn-login'), phone=document.getElementById('login-phone').value.trim(), pass=document.getElementById('login-pass').value;
                btn.innerText="..."; btn.disabled=true;
                const cloud = await this.fetchCloud();
                const users = cloud.users || {};
                if(users[phone] && users[phone].pass === pass) {
                    this.currentUser = phone; this.data = users[phone];
                    localStorage.setItem('space_data_'+phone, JSON.stringify(this.data));
                    this.enterApp();
                } else { this.notify("Dados incorretos", "error"); }
                btn.innerText="ENTRAR"; btn.disabled=false;
            },
            logout: function() { location.reload(); },

            // --- PROFILE EXTRAS ---
            changeAvatar: function(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        app.data.photo = e.target.result; // Base64
                        app.updateProfileUI();
                        app.sync(); // Salva na nuvem
                        app.notify("Foto atualizada!", "success");
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            },
            updateProfileUI: function() {
                const el = document.getElementById('profile-avatar');
                if(this.data.photo) {
                    el.style.backgroundImage = `url(${this.data.photo})`;
                    el.innerHTML = "";
                } else {
                    el.style.backgroundImage = "";
                    el.innerHTML = "üì∑";
                }
            },
            promptPasswordChange: function() {
                const newPass = prompt("Digite sua nova senha:");
                if(newPass && newPass.length >= 4) {
                    this.data.pass = newPass;
                    this.sync();
                    this.notify("Senha alterada com sucesso!", "success");
                } else if (newPass) {
                    this.notify("Senha muito curta.", "error");
                }
            },

            // --- NAVEGA√á√ÉO ---
            enterApp: function() {
                document.getElementById('screen-login').classList.remove('active');
                document.getElementById('bottom-nav').style.display = 'flex';
                this.nav('home', document.querySelector('.nav-item'));
                
                document.getElementById('profile-name').innerText = this.data.name;
                document.getElementById('profile-id').innerText = this.data.invite_code;
                document.getElementById('my-referral-code').innerText = this.data.invite_code;
                this.updateProfileUI();
                this.updateHUD();
            },
            nav: function(screenId, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('screen-' + screenId).classList.add('active');
                if(el) {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    el.classList.add('active');
                }
                if(screenId === 'wallet') document.getElementById('wallet-balance').innerText = this.data.ore.toLocaleString();
                if(screenId === 'fleet') this.renderFleet();
            },

            // --- CORE ---
            updateHUD: function() {
                document.getElementById('hud-gems').innerText = this.data.gems.toLocaleString();
                document.getElementById('hud-ore').innerText = this.data.ore.toLocaleString();
                let daily = 0; this.data.ships.forEach(s => daily += s.yield);
                document.getElementById('hud-prod').innerText = daily.toLocaleString() + "/dia";
            },
            notify: function(msg, type) {
                const c = document.getElementById('toast-container'); const d = document.createElement('div');
                d.className = `toast ${type}`; d.innerText = msg; c.appendChild(d);
                setTimeout(() => { d.style.opacity='0'; setTimeout(()=>d.remove(),300); }, 3000);
            },
            save: function() { if(this.currentUser) localStorage.setItem('space_data_'+this.currentUser, JSON.stringify(this.data)); },
            
            // --- GAME FUNCTIONS ---
            renderHangar: function() {
                const l = document.getElementById('list-hangar'); l.innerHTML="";
                this.config.ships.forEach((s, i) => {
                    const rp = (s.cost/1000).toFixed(2);
                    l.innerHTML += `
                    <div class="plan-item">
                        <div class="plan-icon">üöÄ</div>
                        <div style="flex:1;">
                            <div style="font-weight:bold;">${s.name}</div>
                            <div style="font-size:12px;color:#aaa;">Custo: <span style="color:var(--secondary)">${s.cost.toLocaleString()} üíé</span></div>
                            <div style="font-size:12px;color:#aaa;">Renda: <span style="color:var(--success)">${s.yield} üì¶/dia</span></div>
                        </div>
                        <button class="btn-primary" style="width:auto; padding:8px 15px; margin:0;" onclick="app.buyShip(${i})">COMPRAR</button>
                    </div>`;
                });
            },
            buyShip: function(i) {
                const s = this.config.ships[i];
                if(this.data.gems < s.cost) return this.notify("Cristais insuficientes", "error");
                this.data.gems -= s.cost;
                this.data.ships.push({ name:s.name, yield:s.yield, lastCollect:Date.now() });
                this.sync(); this.updateHUD(); this.renderFleet(); this.notify("Sucesso!", "success");
            },
            renderFleet: function() {
                const l = document.getElementById('list-fleet');
                if(this.data.ships.length===0) return l.innerHTML='<p class="text-center" style="color:#666;margin-top:50px">Vazio.</p>';
                l.innerHTML=""; const now=Date.now();
                this.data.ships.forEach((s, i) => {
                    const cd = 86400000; const diff = now - s.lastCollect;
                    let btn = "";
                    if(diff >= cd) btn = `<button class="btn-primary" style="margin-top:5px;padding:8px;" onclick="app.collect(${i})">COLETAR</button>`;
                    else { 
                        const h = Math.floor((cd-diff)/3600000); const m = Math.floor(((cd-diff)%3600000)/60000); 
                        btn = `<button class="btn-outline" style="margin-top:5px;padding:8px;cursor:not-allowed;">${h}h ${m}m</button>`; 
                    }
                    l.innerHTML += `
                    <div class="plan-item" style="border-color:var(--success);">
                        <div class="plan-icon" style="color:var(--success);">üõ∞Ô∏è</div>
                        <div style="flex:1;">
                            <div style="font-weight:bold;">${s.name}</div>
                            <div style="font-size:12px;">Carga: ${s.yield} üì¶</div>
                        </div>
                        <div style="width:100px;">${btn}</div>
                    </div>`;
                });
            },
            collect: function(i) {
                const s = this.data.ships[i];
                const now = Date.now();
                if(now - s.lastCollect < 86400000) return;
                this.data.ore += s.yield; s.lastCollect = now;
                this.sync(); this.updateHUD(); this.renderFleet(); this.notify("Coletado!", "success");
            },
            renderShop: function() {
                const l=document.getElementById('list-shop'); l.innerHTML="";
                this.config.shopPacks.forEach((p,i) => {
                    l.innerHTML += `
                    <div class="plan-item">
                        <div style="flex:1;">
                            <div style="font-weight:bold;color:var(--secondary);">${p.gems.toLocaleString()} Cristais</div>
                            <div style="font-size:12px;">Valor: R$ ${p.price},00</div>
                        </div>
                        <button class="btn-primary" style="width:auto; padding:8px 15px; margin:0;" onclick="app.openPixModal(${i})">COMPRAR</button>
                    </div>`;
                });
            },
            openPixModal: function(i) { 
                document.getElementById('pix-display-area').value = this.config.shopPacks[i].pix; 
                document.getElementById('modal-pix').style.display = 'flex'; 
            },
            copyPix: function() { 
                document.getElementById("pix-display-area").select(); 
                navigator.clipboard.writeText(document.getElementById("pix-display-area").value); 
                this.notify("Copiado!", "success"); 
            },
            redeemCode: function() {
                const inp=document.getElementById('redeem-input'), c=inp.value.trim().toUpperCase();
                if(!c) return;
                if(this.data.usedCodes.includes(c)) return this.notify("J√° usado", "error");
                if(this.config.codes[c]) {
                    const amt=this.config.codes[c]; this.data.gems+=amt; this.data.usedCodes.push(c);
                    this.sync(); this.updateHUD(); this.notify(`+${amt} Cristais`, "success"); inp.value="";
                } else { this.notify("Inv√°lido", "error"); }
            },
            sellResources: async function() {
                const amount = parseInt(document.getElementById('withdraw-amount').value);
                const pixKey = document.getElementById('withdraw-key').value.trim();
                const btn = document.getElementById('btn-withdraw');
                if(!amount || amount<10000) return this.notify("M√≠nimo 10.000", "error");
                if(amount > this.data.ore) return this.notify("Saldo insuficiente", "error");
                if(!pixKey) return this.notify("Chave Pix obrigat√≥ria", "error");
                btn.disabled=true; btn.innerText="ENVIANDO...";
                const cloud = await this.fetchCloud();
                if(!cloud.withdrawals) cloud.withdrawals = [];
                const gross = amount/1000; const net = gross - (gross * this.config.withdraw_fee);
                const req = { id: Date.now().toString(), userId: this.currentUser, userName: this.data.name, amount: amount, amountReais: net.toFixed(2), pixKey: pixKey, status: "Pendente", date: new Date().toLocaleString() };
                this.data.ore -= amount;
                cloud.users[this.currentUser] = this.data; cloud.withdrawals.push(req);
                await this.saveCloud(cloud);
                this.sync(); this.updateHUD();
                document.getElementById('wallet-balance').innerText = this.data.ore.toLocaleString();
                this.notify("Solicita√ß√£o enviada!", "success"); btn.disabled=false; btn.innerText="SOLICITAR";
            },
            copyOnlyLink: function() {
                const t = window.location.href.split('?')[0] + "?ref=" + this.data.invite_code;
                navigator.clipboard.writeText(t); this.notify("Link copiado!", "success");
            },
            redeemCommission: function() {
                const inp=document.getElementById('comm-input'), c=inp.value.trim().toUpperCase();
                if(!c) return;
                if(this.data.usedCodes.includes("NET_"+c)) return this.notify("J√° usado", "error");
                if(this.config.commCodes[c]) {
                    const amt=this.config.commCodes[c]; this.data.ore+=amt; 
                    this.data.usedCodes.push("NET_"+c);
                    this.sync(); this.updateHUD(); this.notify(`+${amt} Dark Matter`, "success"); inp.value="";
                } else { this.notify("Inv√°lido", "error"); }
            },
            secretAdmin: function() { 
                const p=prompt("Senha:"); 
                if(p==="admin123") { 
                    const a=parseInt(prompt("Cristais:")); 
                    if(a) { this.data.gems+=a; this.sync(); this.updateHUD(); this.notify("Feito!", "success"); } 
                } 
            }
        };
        window.onload = function() { app.init(); };
    </script>
</body>
</html>
